"!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t((e=\"undefined\"!=typeof globalThis?globalThis:e||self).Comlink={})}(this,(function(e){\"use strict\";const t=Symbol(\"Comlink.proxy\"),n=Symbol(\"Comlink.endpoint\"),r=Symbol(\"Comlink.releaseProxy\"),a=Symbol(\"Comlink.finalizer\"),s=Symbol(\"Comlink.thrown\"),i=e=>\"object\"==typeof e&&null!==e||\"function\"==typeof e,o=new Map([[\"proxy\",{canHandle:e=>i(e)&&e[t],serialize(e){const{port1:t,port2:n}=new MessageChannel;return c(e,t),[n,[n]]},deserialize:e=>(e.start(),u(e))}],[\"throw\",{canHandle:e=>i(e)&&s in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function c(e,t=globalThis,n=[\"*\"]){t.addEventListener(\"message\",(function r(i){if(!i||!i.data)return;if(!function(e,t){for(const n of e){if(t===n||\"*\"===n)return!0;if(n instanceof RegExp&&n.test(t))return!0}return!1}(n,i.origin))return void console.warn(`Invalid origin '${i.origin}' for comlink proxy`);const{id:o,type:u,path:d}=Object.assign({path:[]},i.data),p=(i.data.argumentList||[]).map(h);let f;try{const t=d.slice(0,-1).reduce(((e,t)=>e[t]),e),n=d.reduce(((e,t)=>e[t]),e);switch(u){case\"GET\":f=n;break;case\"SET\":t[d.slice(-1)[0]]=h(i.data.value),f=!0;break;case\"APPLY\":f=n.apply(t,p);break;case\"CONSTRUCT\":f=y(new n(...p));break;case\"ENDPOINT\":{const{port1:t,port2:n}=new MessageChannel;c(e,n),f=E(t,[t])}break;case\"RELEASE\":f=void 0;break;default:return}}catch(e){f={value:e,[s]:0}}Promise.resolve(f).catch((e=>({value:e,[s]:0}))).then((n=>{const[s,i]=b(n);t.postMessage(Object.assign(Object.assign({},s),{id:o}),i),\"RELEASE\"===u&&(t.removeEventListener(\"message\",r),l(t),a in e&&\"function\"==typeof e[a]&&e[a]())})).catch((e=>{const[n,r]=b({value:new TypeError(\"Unserializable return value\"),[s]:0});t.postMessage(Object.assign(Object.assign({},n),{id:o}),r)}))})),t.start&&t.start()}function l(e){(function(e){return\"MessagePort\"===e.constructor.name})(e)&&e.close()}function u(e,t){return w(e,[],t)}function d(e){if(e)throw new Error(\"Proxy has been released and is not useable\")}function p(e){return L(e,{type:\"RELEASE\"}).then((()=>{l(e)}))}const f=new WeakMap,g=\"FinalizationRegistry\"in globalThis&&new FinalizationRegistry((e=>{const t=(f.get(e)||0)-1;f.set(e,t),0===t&&p(e)}));function w(e,t=[],a=function(){}){let s=!1;const i=new Proxy(a,{get(n,a){if(d(s),a===r)return()=>{!function(e){g&&g.unregister(e)}(i),p(e),s=!0};if(\"then\"===a){if(0===t.length)return{then:()=>i};const n=L(e,{type:\"GET\",path:t.map((e=>e.toString()))}).then(h);return n.then.bind(n)}return w(e,[...t,a])},set(n,r,a){d(s);const[i,o]=b(a);return L(e,{type:\"SET\",path:[...t,r].map((e=>e.toString())),value:i},o).then(h)},apply(r,a,i){d(s);const o=t[t.length-1];if(o===n)return L(e,{type:\"ENDPOINT\"}).then(h);if(\"bind\"===o)return w(e,t.slice(0,-1));const[c,l]=m(i);return L(e,{type:\"APPLY\",path:t.map((e=>e.toString())),argumentList:c},l).then(h)},construct(n,r){d(s);const[a,i]=m(r);return L(e,{type:\"CONSTRUCT\",path:t.map((e=>e.toString())),argumentList:a},i).then(h)}});return function(e,t){const n=(f.get(t)||0)+1;f.set(t,n),g&&g.register(e,t,e)}(i,e),i}function m(e){const t=e.map(b);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const v=new WeakMap;function E(e,t){return v.set(e,t),e}function y(e){return Object.assign(e,{[t]:!0})}function b(e){for(const[t,n]of o)if(n.canHandle(e)){const[r,a]=n.serialize(e);return[{type:\"HANDLER\",name:t,value:r},a]}return[{type:\"RAW\",value:e},v.get(e)||[]]}function h(e){switch(e.type){case\"HANDLER\":return o.get(e.name).deserialize(e.value);case\"RAW\":return e.value}}function L(e,t,n){return new Promise((r=>{const a=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join(\"-\");e.addEventListener(\"message\",(function t(n){n.data&&n.data.id&&n.data.id===a&&(e.removeEventListener(\"message\",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:a},t),n)}))}var k=Object.freeze({__proto__:null,createEndpoint:n,expose:c,finalizer:a,proxy:y,proxyMarker:t,releaseProxy:r,transfer:E,transferHandlers:o,windowEndpoint:function(e,t=globalThis,n=\"*\"){return{postMessage:(t,r)=>e.postMessage(t,n,r),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}},wrap:u});const{createEndpoint:x,finalizer:M,proxy:R,proxyMarker:N,releaseProxy:S,transfer:T,transferHandlers:O,windowEndpoint:P,wrap:z}=k;e.createEndpoint=x,e.expose=(...e)=>{1===e.length&&\"ReactNativeWebView\"in window&&c(e[0],function(){const e=new WeakMap;return{postMessage:e=>{const t=JSON.stringify(e);window.ReactNativeWebView.postMessage(t)},addEventListener:(t,n)=>{const r=e=>{const t=e.data,r=JSON.parse(t);\"handleEvent\"in n?n.handleEvent({data:r}):n({data:r})};document.addEventListener(\"message\",r),window.addEventListener(\"message\",r),e.set(n,r)},removeEventListener:(t,n)=>{const r=e.get(n);r&&(document.removeEventListener(\"message\",r),window.removeEventListener(\"message\",r),e.delete(n))},start:()=>{\"start\"in window.ReactNativeWebView&&\"function\"==typeof window.ReactNativeWebView.start&&window.ReactNativeWebView.start&&window.ReactNativeWebView.start.bind(window.ReactNativeWebView)}}}()),c(...e),window.ReactNativeWebView.postMessage(\"onComlinkExpose\")},e.finalizer=M,e.proxy=R,e.proxyMarker=N,e.releaseProxy=S,e.transfer=T,e.transferHandlers=O,e.windowEndpoint=P,e.wrap=z}));"
